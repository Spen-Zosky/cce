<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCE Dashboard</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/alpinejs@3/dist/cdn.min.js" defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #e0e0e0;
            padding: 20px;
        }
        
        .sidebar h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .sidebar .version {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        
        .nav-item {
            display: block;
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 5px;
            border: none;
            background: transparent;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-item:hover {
            background: #f0f0f0;
        }
        
        .nav-item.active {
            background: #3b82f6;
            color: white;
        }
        
        .main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-badge.success {
            color: #10b981;
        }
        
        .status-badge.error {
            color: #ef4444;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.2s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }
        
        h2 {
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .loading {
            color: #666;
            padding: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container" x-data="dashboard()">
        <!-- Sidebar -->
        <div class="sidebar">
            <h1>CCE Dashboard</h1>
            <p class="version">v2.0.0</p>
            
            <nav>
                <button class="nav-item" :class="{ active: activeTab === 'status' }" @click="activeTab = 'status'">
                    System Status
                </button>
                <button class="nav-item" :class="{ active: activeTab === 'mcp' }" @click="activeTab = 'mcp'">
                    MCP Servers
                </button>
                <button class="nav-item" :class="{ active: activeTab === 'projects' }" @click="activeTab = 'projects'">
                    Projects
                </button>
                <button class="nav-item" :class="{ active: activeTab === 'agents' }" @click="activeTab = 'agents'">
                    Agents
                </button>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main">
            <!-- System Status Tab -->
            <div x-show="activeTab === 'status'">
                <h2>System Status</h2>
                
                <div class="grid">
                    <div class="card">
                        <h3>CCE Environment</h3>
                        <div x-show="!loading.status" x-html="renderStatus()"></div>
                        <div x-show="loading.status" class="loading">Loading...</div>
                    </div>
                    
                    <div class="card">
                        <h3>Claude CLI</h3>
                        <div x-show="!loading.status" x-html="renderClaude()"></div>
                        <div x-show="loading.status" class="loading">Loading...</div>
                    </div>
                    
                    <div class="card">
                        <h3>System Resources</h3>
                        <div x-show="!loading.status" x-html="renderResources()"></div>
                        <div x-show="loading.status" class="loading">Loading...</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Quick Actions</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary">Create New Project</button>
                        <button class="btn btn-secondary" @click="loadStatus()">Refresh Status</button>
                        <button class="btn btn-secondary">Update CCE</button>
                    </div>
                </div>
            </div>
            
            <!-- MCP Servers Tab -->
            <div x-show="activeTab === 'mcp'">
                <h2>MCP Servers</h2>
                <div x-show="!loading.mcp" x-html="renderMCPServers()"></div>
                <div x-show="loading.mcp" class="loading">Loading MCP servers...</div>
            </div>
            
            <!-- Projects Tab -->
            <div x-show="activeTab === 'projects'">
                <h2>Projects</h2>
                <div x-show="!loading.projects" x-html="renderProjects()"></div>
                <div x-show="loading.projects" class="loading">Loading projects...</div>
            </div>
            
            <!-- Agents Tab -->
            <div x-show="activeTab === 'agents'">
                <h2>AI Agents</h2>
                <div class="card">
                    <h3>Execute Agent</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Select Agent:</label>
                        <select x-model="selectedAgent" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="coder">Coder - Write code</option>
                            <option value="reviewer">Reviewer - Review code</option>
                            <option value="tester">Tester - Generate tests</option>
                            <option value="documenter">Documenter - Create docs</option>
                            <option value="debugger">Debugger - Fix bugs</option>
                            <option value="deployer">Deployer - Setup deployment</option>
                            <option value="analyzer">Analyzer - Code analysis</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px;">Arguments:</label>
                        <textarea x-model="agentArgs" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; height: 100px;"></textarea>
                    </div>
                    
                    <button class="btn btn-primary" @click="executeAgent()" :disabled="executing">
                        <span x-show="!executing">Execute Agent</span>
                        <span x-show="executing">Executing...</span>
                    </button>
                    
                    <div x-show="agentOutput" style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px;">Output:</h4>
                        <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto;" x-text="agentOutput"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function dashboard() {
            return {
                activeTab: 'status',
                apiBase: 'http://localhost:3456/api/v1',
                loading: {
                    status: true,
                    mcp: true,
                    projects: true
                },
                data: {
                    status: null,
                    mcp: null,
                    projects: null
                },
                selectedAgent: 'coder',
                agentArgs: '',
                agentOutput: '',
                executing: false,
                
                init() {
                    this.loadStatus();
                    this.loadMCP();
                    this.loadProjects();
                    
                    // Auto-refresh
                    setInterval(() => {
                        if (this.activeTab === 'status') this.loadStatus();
                    }, 5000);
                },
                
                async loadStatus() {
                    try {
                        const response = await axios.get(`${this.apiBase}/status`);
                        this.data.status = response.data;
                        this.loading.status = false;
                    } catch (error) {
                        console.error('Failed to load status:', error);
                    }
                },
                
                async loadMCP() {
                    try {
                        const response = await axios.get(`${this.apiBase}/mcp/servers`);
                        this.data.mcp = response.data;
                        this.loading.mcp = false;
                    } catch (error) {
                        console.error('Failed to load MCP servers:', error);
                    }
                },
                
                async loadProjects() {
                    try {
                        const response = await axios.get(`${this.apiBase}/projects`);
                        this.data.projects = response.data;
                        this.loading.projects = false;
                    } catch (error) {
                        console.error('Failed to load projects:', error);
                    }
                },
                
                async executeAgent() {
                    this.executing = true;
                    this.agentOutput = '';
                    
                    try {
                        const response = await axios.post(`${this.apiBase}/agents/execute`, {
                            agent: this.selectedAgent,
                            args: this.agentArgs
                        });
                        this.agentOutput = response.data.stdout || response.data.error || 'No output';
                    } catch (error) {
                        this.agentOutput = `Error: ${error.message}`;
                    } finally {
                        this.executing = false;
                    }
                },
                
                renderStatus() {
                    if (!this.data.status) return '';
                    const s = this.data.status;
                    return `
                        <div>Version: <strong>${s.cce?.version || 'N/A'}</strong></div>
                        <div>Environment: <strong>${s.cce?.environment || 'N/A'}</strong></div>
                        <div>Architecture: <strong>${s.cce?.architecture || 'N/A'}</strong></div>
                    `;
                },
                
                renderClaude() {
                    if (!this.data.status) return '';
                    const s = this.data.status;
                    return `
                        <div class="status-badge ${s.claude?.installed ? 'success' : 'error'}">
                            Installation: ${s.claude?.installed ? '✓ Installed' : '✗ Not installed'}
                        </div>
                        <br>
                        <div class="status-badge ${s.apiKey?.configured ? 'success' : 'error'}">
                            API Key: ${s.apiKey?.configured ? '✓ Configured' : '✗ Not configured'}
                        </div>
                    `;
                },
                
                renderResources() {
                    if (!this.data.status) return '';
                    const s = this.data.status;
                    const uptime = Math.floor((s.uptime || 0) / 60);
                    const memory = Math.round((s.memory?.heapUsed || 0) / 1024 / 1024);
                    return `
                        <div>Uptime: <strong>${uptime} minutes</strong></div>
                        <div>Memory: <strong>${memory} MB</strong></div>
                        <div>Node: <strong>${s.node || 'N/A'}</strong></div>
                    `;
                },
                
                renderMCPServers() {
                    if (!this.data.mcp?.servers) return '<div class="card">No servers found</div>';
                    
                    return this.data.mcp.servers.map(server => `
                        <div class="card">
                            <h3>${server.name}</h3>
                            <div class="status-badge ${server.installed ? 'success' : 'error'}">
                                ${server.installed ? '✓ Installed' : '✗ Not installed'}
                            </div>
                            <div style="margin-top: 10px;">
                                <code style="font-size: 12px; color: #666;">${server.package}</code>
                            </div>
                            ${server.installed ? 
                                '<button class="btn btn-secondary" style="margin-top: 10px;">Test</button>' : 
                                '<button class="btn btn-primary" style="margin-top: 10px;">Install</button>'
                            }
                        </div>
                    `).join('');
                },
                
                renderProjects() {
                    if (!this.data.projects?.projects) return '<div class="card">No projects found</div>';
                    
                    return '<div class="grid">' + this.data.projects.projects.map(project => `
                        <div class="card">
                            <h3>${project.name}</h3>
                            ${project.description ? `<p style="color: #666; margin-bottom: 10px;">${project.description}</p>` : ''}
                            <div style="margin-top: 10px;">
                                ${project.hasClaude ? '<span class="status-badge success">✓ CCE</span>' : ''}
                                ${project.hasPackageJson ? '<span class="status-badge success">📦 Node</span>' : ''}
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn btn-primary">Open</button>
                                <button class="btn btn-secondary" style="margin-left: 5px;">Run Agent</button>
                            </div>
                        </div>
                    `).join('') + '</div>';
                }
            }
        }
    </script>
</body>
</html>